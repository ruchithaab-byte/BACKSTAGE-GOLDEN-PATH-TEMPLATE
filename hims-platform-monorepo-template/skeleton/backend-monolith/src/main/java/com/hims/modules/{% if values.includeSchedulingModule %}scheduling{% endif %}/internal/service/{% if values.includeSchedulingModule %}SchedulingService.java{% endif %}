package com.hims.modules.scheduling.internal.service;

import com.hims.core.audit.LogAudit;
import com.hims.core.events.EventPublisher;
import com.hims.core.events.EventMetadata;
import com.hims.core.tenant.TenantContext;
import com.hims.modules.scheduling.api.spi.SchedulingServiceProvider;
import com.hims.modules.scheduling.internal.domain.Appointment;
import com.hims.modules.scheduling.internal.repo.AppointmentRepository;
import org.springframework.stereotype.Service;

import java.util.Map;
import java.util.UUID;

/**
 * Service implementation for Scheduling module.
 * 
 * Pattern: Scheduling Module
 */
@Service
public class SchedulingService implements SchedulingServiceProvider {

    private final AppointmentRepository repository;
    private final EventPublisher eventPublisher;

    public SchedulingService(AppointmentRepository repository, EventPublisher eventPublisher) {
        this.repository = repository;
        this.eventPublisher = eventPublisher;
    }

    @LogAudit(action = "CREATE_APPOINTMENT", resourceType = "APPOINTMENT", description = "Create appointment")
    public void createExample() {
        String tenantId = TenantContext.getTenantId();
        String userId = TenantContext.getUserId();
        eventPublisher.publish("scheduling.appointment.created", Map.of("id", "example-id"), EventMetadata.create().withTenant(tenantId).withUser(userId).build());
    }
}

