# Service Identity
spring.application.name={{ values.serviceName }}
server.port=8080

# === PostgreSQL Database ===
spring.datasource.url=jdbc:postgresql://localhost:5432/{{ values.postgresDbName }}
spring.datasource.username=${POSTGRES_USER}
spring.datasource.password=${POSTGRES_PASS}

# === Multi-Tenancy (Schema-per-Tenant) ===
spring.jpa.properties.hibernate.multiTenancy=SCHEMA
spring.jpa.properties.hibernate.tenant_identifier_resolver=com.hms.servicename.tenancy.TenantIdentifierResolver
spring.jpa.properties.hibernate.multi_tenant_connection_provider=com.hms.servicename.tenancy.MultiTenantConnectionProvider
spring.jpa.hibernate.ddl-auto=validate

# === ScaleKit Auth (Base) ===
scalekit.env.url=${SCALEKIT_ENVIRONMENT_URL}
scalekit.client.id=${SCALEKIT_CLIENT_ID}
scalekit.client.secret=${SCALEKIT_CLIENT_SECRET}

# 1. Resource Server (Stateless) Config - ALWAYS ON
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${scalekit.env.url}/.well-known/jwks
spring.security.oauth2.resourceserver.jwt.issuer-uri=${scalekit.env.url}

# === CONDITIONAL CONFIGURATIONS ===
{% if values.servicePattern == 'saas-backend-for-frontend' %}
# 2. OIDC Client (Stateful) Config - ONLY FOR BFF
scalekit.webhook.secret=${SCALEKIT_WEBHOOK_SECRET}

spring.security.oauth2.client.registration.scalekit.provider=scalekit
spring.security.oauth2.client.registration.scalekit.client-id=${scalekit.client.id}
spring.security.oauth2.client.registration.scalekit.client-secret=${scalekit.client.secret}
spring.security.oauth2.client.registration.scalekit.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.scalekit.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.scalekit.scope=openid,profile,email,offline_access

spring.security.oauth2.client.provider.scalekit.authorization-uri=${scalekit.env.url}/authorize
spring.security.oauth2.client.provider.scalekit.token-uri=${scalekit.env.url}/token
spring.security.oauth2.client.provider.scalekit.user-info-uri=${scalekit.env.url}/userinfo
spring.security.oauth2.client.provider.scalekit.jwk-set-uri=${scalekit.env.url}/.well-known/jwks
spring.security.oauth2.client.provider.scalekit.user-name-attribute=sub
{% endif %}

{% if values.includeFlowable %}
# === Flowable (Workflow) Config ===
flowable.check-process-definitions=false
flowable.eventregistry.enabled=true
{% endif %}

{% if values.includeKafkaConsumer %}
# === Kafka (CQRS Projector) Config ===
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id={{ values.kafkaGroupId | default('default-projector-group') }}
spring.kafka.consumer.auto-offset-reset=earliest
{% endif %}

{% if values.includeRedis %}
# === Redis (CQRS Read Model) Config ===
spring.redis.host=localhost
spring.redis.port=6379
{% endif %}

